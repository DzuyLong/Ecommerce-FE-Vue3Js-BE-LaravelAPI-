<template>
    <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 justify-items-center relative w-full">
        <Spinner v-if="loading" class="absolute left-0 top-0 bg-white right-0 bottom-0 flex items-center justify-center"/>
        
            <div v-for="(product, index) in products" :key="product.id" class=" bg-white rounded-lg shadow-md
            hover:translate-y-[-2px] hover:shadow-stone-500 transition-all duration-400 ease-linear 
            dark:bg-gray-800 dark:border-gray-700">
            <router-link class="border-solid border-b-2 block  m-3 border-slate-200" :to="{params: {slug: product.slug}, name: 'ProductDetails'}">         
                    <img class="object-fill h-48 w-96 md:mb-2 mb-4" :src="product.image_url" alt="product image" />
            </router-link>
                <div class="px-5 pb-5">
                    <a href="#">
                        <h5 class="text-xl font-semibold tracking-tight text-gray-900 dark:text-white">{{ product.title }}</h5>
                        <p>{{ product.description }}</p>
                    </a>
                    <div class="flex items-center mt-1 mb-2">
                        <svg aria-hidden="true" class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>First star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <svg aria-hidden="true" class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Second star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <svg aria-hidden="true" class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Third star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <svg aria-hidden="true" class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Fourth star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <svg aria-hidden="true" class="w-5 h-5 text-yellow-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Fifth star</title><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800 ml-3">5.0</span>
                    </div>
                    <div class="flex items-center flex-col justify-between">
                        <span class="text-3xl font-bold mb-1 text-gray-900 dark:text-white"> {{ $filters.currencyUSD(product.price) }}</span>
                        <button  class="text-white bg-amber-700 hover:bg-amber-800 
                        focus:ring-4 focus:outline-none focus:ring-amber-500 font-medium 
                        rounded-lg text-sm px-4 py-2 text-center hover:translate-y-[-1px] transition-all duration-400"
                        @click="addToCart(product.id)">
                            <i class="bi bi-bag-plus-fill mr-2"></i>Add to cart</button>
                    </div>
                </div>
            </div>
    </div>
    </template>
    
    <script setup>  
    import {computed, onMounted, ref} from "vue";
    import Spinner from "../../../components/core/Spinner.vue";
    import store from "../../../store";
    import Swal from 'sweetalert2';
    import router from "../../../router";
    const loading = ref(true);
    const products = ref({});
    onMounted(() => {
        getProducts();
      })
    function getProducts() {
        loading.value = true;
        store.dispatch("getProductsHP").
        then(({data}) => {
            loading.value = false;
            products.value  = data.data;
          });
      }
      const isConfirm = ref(false);
    function addToCart(productId) {
        store.dispatch("addToCart", productId).
        then(async (response) => {
            isConfirm.value = true;
            await Swal.fire({
                title: 'Thêm sản phẩm vào giỏ hàng thành công',
                text: 'Bạn có muốn xem chi tiết giỏ hàng?',
                icon: 'success',
                showCancelButton: true,
                confirmButtonText: 'Xem chi tiết',
                cancelButtonText: 'Trở về',
                preConfirm: () => {
                     router.push({name: 'cartDetails'});
             }
        });
        }).catch(error => {
          console.error(error);
        });
    }

    </script>